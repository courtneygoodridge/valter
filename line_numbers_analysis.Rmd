---
title: "lie_numbers_analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages}
# opening data
library(openxlsx) # loads data sets from multiple sheet

# data vis
library(ggplot2) # for plotting
library(scales) # Scale Functions for Visualization
library(gplots) # for plotting

# data manipulation
library(dplyr) # data manipulation
library(tidyr) # data manipulation
library(readxl) # reading excel files 

# stats
library(ez) # allows me to perform the ANOVA
library(car) # inferential stats
library(MASS) # inferential stats
library(EnvStats) # inferential stats
library(Rmisc) # confidence intervals 
library(sjstats) # for calculating effect sizes

# frequetist modelling/multi-level modelling
library(lme4) # for linear mixed effects modelling
library(nlme) # non linear mixed effects modelling
library(fitdistrplus) # fitting distribution modelling 
library(lmtest) # testing linear regression models
library(caret) # classification and regression training
library(merTools) # multi leveling modelling

# bayesian modelling
library(rstanarm) # for bayesian modelling
library(bayesplot) # for bayesian modelling
library(loo) # comparison of bayesian modelling

```

```{r data upload} 
# rm(list = ls())

# load control data
# set working directory on personal laptop
#setwd("C:/Users/Courtney/Documents/PhD/Valter")
setwd("C:/Users/pscmgo/OneDrive for Business/PhD/Project/Experiment_Code/valter/")

dat <- loadWorkbook("Data_Lie_Numbers_Clean.xlsx")
sheetNames <- sheets(dat)
for(i in 1:length(sheetNames)){
  assign(sheetNames[i], readWorkbook(dat, sheet = i))
}

```

**Experiment description**

Participants are told that they are hackers that have stolen codes. The police want to crack the code but participants have to communicate codes to their lawyers without being caught.

**Control_SNARC** 

Participants shown just picture of the lawyers and a number. Participants have to respond with equivalent number (odd or even). 

**Lie_SNARC**

In the lie condition, sometimes the picture was the lawyer and other times it was the cop. When it was the cop, they had to lie (i.e. they had to repond with the opposite key. If the number was odd they had to respond as if it was even). 

In this lie condition, there are trials where the participant has to answer truthfully and also has to lie. 

**Understanding column names and data types**

Key: a = left key, g = right key 

Accuracy: 1 = correct, 0 = incorrect

Condition: controltrue = control condition (truth), exptrue = exp truth condition, explie = exp lie condition

In the **Control_SNARC**, they had a standard SNARC with context of being in court

In **Lie_SNARC** 2/3 trials were true (standard SNARC) whereas the 1/3 of trials participants had to lie.

```{r data cleaning - renaming conditions}

# cleaning control condition
Control_SNARC <- Control_SNARC %>%
  dplyr::select(numbers, condition, key, accuracy, RTs, participant) %>%
  arrange(participant) %>%
  mutate(condition = "controltrue")

# cleaning experimental conditon
Lie_SNARC <- Lie_SNARC %>%
  dplyr::select(numbers, condition, key, accuracy, RTs, participant) %>%
  arrange(participant)

exptrue <- Lie_SNARC %>%
  dplyr::filter(condition == "t") %>%
  mutate(condition = "exptrue")

explie <- Lie_SNARC %>%
  dplyr::filter(condition == "l") %>%
  mutate(condition = "explie")

workingdata <- rbind(controldata, exptrue, explie)

```


```{r data cleaning - renaming handedness}
# creating handedness variable
left <- workingdata %>%
  dplyr::filter(key == "a") %>%
  mutate(hand = "left")

right <- workingdata %>%
  dplyr::filter(key == "g") %>%
  mutate(hand = "right")

workingdata <- rbind(left, right)

```


```{r data cleaning - renaming parity}

# creating parity variable
even <- workingdata %>%
  dplyr::filter(numbers %% 2 == 0) %>%
  mutate(parity = "even")

odd <- workingdata %>%
  dplyr::filter(numbers %% 2 == 1) %>%
  mutate(parity = "odd")

workingdata <- rbind(even, odd)

rm(controldata, expdata, explie, exptrue, left, right, even, odd)

```


```{r overview conditions}

# errors in each condition

ggplot(dplyr::filter(workingdata, accuracy == 0) %>%
         group_by(condition) %>%
         summarise(errors = n()), aes(x = condition, y = errors)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = errors)) +
  ggtitle("Number of errors per condition") +
  theme_gray() 

# mean RTS in each condition for correct repsonses

ggplot(dplyr::filter(workingdata, accuracy == 0) %>%
         group_by(condition) %>%
         summarise(meanRT = mean(RTs)), aes(x = condition, y = meanRT)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = meanRT)) +
  ggtitle("Mean reaction time (s)") +
  theme_gray() 


```


```{r ONLY LAYWER - control condition (RT)}

# line graph demonstrating RTs over each number subjects were given
ggplot(data = workingdata %>%
         dplyr::filter(condition == "controltrue") %>%
         dplyr::group_by(numbers, hand) %>%
         summarise(meanRT = mean(RTs)), aes(x = numbers, y = meanRT, col = hand)) +
  geom_point() +
  geom_line()

# bar charts (with 95% confidence intervals) shwoing RTs for odd and even numbers
OddEffect <- workingdata %>%
  dplyr::filter(condition == "controltrue")

CI_OddEffect <- summarySE(OddEffect, measurevar = "RTs", groupvars = c("parity"))

ggplot(CI_OddEffect, aes(x = parity, y = RTs)) + 
  geom_line() +
  geom_errorbar(aes(ymin = RTs - se, ymax = RTs + se), width = .1) +
  geom_point()

t.test(RTs ~ parity, data = OddEffect)

# MARC effect bar chart (with 95% confidence intervals) for parity x hand - shows interaction

result <- ezANOVA(workingdata, dv = RTs, wid = participant, within = .(parity, hand), type = 3, detailed = TRUE, return_aov = TRUE)
result

eta_sq(result$aov, partial = TRUE)

CIerror_bar <- summarySE(workingdata, measurevar = "RTs", groupvars = c("parity", "hand"))

ggplot(data = CIerror_bar, aes(x = parity, color = hand, group = hand, y = RTs)) +
         stat_summary(fun.y = mean, geom = "point") +
         stat_summary(fun.y = mean, geom = "line") +
  geom_errorbar(aes(ymin = RTs - se, ymax = RTs + se), width = .1)

```

*Notes on this section of the analysis*

*Line plots on left and right hand versus number responding to*
Line plots match the ones displayed by Valter

*Odd effect*
Unsure why Valter has done an ANOVA for testing the parity because there are only 2 factors (odd and even). Either way, it comes out as non-signifcant. I also prefer the mean points with error bars rather than with bar charts.

*2x2 ANOVA (parity x hand)*
My data set seems to have more participants than Valter's which might explain why my results are significant and his are not. I also prefer the line graphs to see the interaction.

*TO DO*

- Check if I'm importing data right - I can import data from one excel files from multiple sheets? (Yes I can, I just need to figure out how).

